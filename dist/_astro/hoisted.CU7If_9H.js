function k(e){const o=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,t=e.match(o);return t&&t[2].length===11?t[2]:null}const c=document.getElementById("youtubeModal"),f=document.getElementById("youtubeIframe"),q=document.getElementById("closeModal"),d=document.getElementById("passwordModal"),M=document.getElementById("passwordForm"),r=document.getElementById("passwordInput"),L=document.getElementById("passwordError"),z=document.getElementById("passwordMaterialName"),A=document.getElementById("closePasswordModal"),x=document.getElementById("cancelPasswordBtn"),u=document.getElementById("listViewBtn"),m=document.getElementById("gridViewBtn"),h=document.getElementById("materialsContainer");document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".youtube-modal-btn"),o=document.querySelectorAll(".password-modal-btn");e.forEach(t=>{t.addEventListener("click",function(){const s=this.getAttribute("data-youtube-url"),i=k(s);i&&c&&f?(f.src=`https://www.youtube.com/embed/${i}`,c.classList.remove("hidden"),document.body.style.overflow="hidden"):s&&window.open(s,"_blank")})}),o.forEach(t=>{t.addEventListener("click",function(){const s=this.getAttribute("data-material-url"),i=this.getAttribute("data-material-password"),n=this.getAttribute("data-material-name"),g=this.getAttribute("data-material-file-type"),a=this.getAttribute("data-is-youtube")==="true";d&&z&&(z.textContent=n,d.setAttribute("data-material-url",s||""),d.setAttribute("data-material-password",i||""),d.setAttribute("data-material-file-type",g||""),d.setAttribute("data-is-youtube",a?"true":"false"),d.classList.remove("hidden"),document.body.style.overflow="hidden",r.focus())})}),q&&q.addEventListener("click",I),c&&c.addEventListener("click",function(t){t.target===c&&I()}),A&&A.addEventListener("click",function(){v()}),x&&x.addEventListener("click",function(){v()}),d&&d.addEventListener("click",function(t){t.target===d&&v()}),M&&M.addEventListener("submit",function(t){t.preventDefault();const s=r.value,i=d.getAttribute("data-material-password"),n=d.getAttribute("data-material-url");if(d.getAttribute("data-material-file-type"),s===i){if(v(),r.value="",L.classList.add("hidden"),d.getAttribute("data-is-youtube")==="true"){const a=k(n);a&&c&&f?(f.src=`https://www.youtube.com/embed/${a}`,c.classList.remove("hidden"),document.body.style.overflow="hidden"):n&&window.open(n,"_blank")}else if(n)if(n.includes("http"))window.open(n,"_blank");else{const a=document.createElement("a");a.href=n,a.download="",a.click()}}else L.classList.remove("hidden"),r.value="",r.focus()}),document.addEventListener("keydown",function(t){t.key==="Escape"&&(c&&!c.classList.contains("hidden")&&I(),d&&!d.classList.contains("hidden")&&v())}),u&&m&&h&&(b("list"),u.addEventListener("click",()=>b("list")),m.addEventListener("click",()=>b("grid")))});function I(){c&&f&&(c.classList.add("hidden"),f.src="",document.body.style.overflow="auto")}function v(){d&&r&&L&&(d.classList.add("hidden"),r.value="",L.classList.add("hidden"),document.body.style.overflow="auto")}function b(e){!h||!u||!m||(u.classList.remove("bg-white","text-gray-900","shadow-sm"),u.classList.add("text-gray-600","hover:text-gray-900"),m.classList.remove("bg-white","text-gray-900","shadow-sm"),m.classList.add("text-gray-600","hover:text-gray-900"),h.classList.remove("grid-view","list-view"),e==="grid"?(h.classList.add("grid-view"),m.classList.remove("text-gray-600","hover:text-gray-900"),m.classList.add("bg-white","text-gray-900","shadow-sm")):(h.classList.add("list-view"),u.classList.remove("text-gray-600","hover:text-gray-900"),u.classList.add("bg-white","text-gray-900","shadow-sm")),localStorage.setItem("preferredView",e))}document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("preferredView");e&&(e==="list"||e==="grid")&&b(e)});document.addEventListener("click",function(e){const t=e.target.closest(".quiz-btn");if(t){const s=t.getAttribute("data-quiz-id"),i=t.getAttribute("data-quiz-show");if(s)if(i==="modal"){const n=document.getElementById("quiz-modal");n&&(n.classList.remove("hidden"),document.body.style.overflow="hidden")}else i==="newpage"&&window.open(`/quiz/${s}`,"_blank")}});const l=document.getElementById("quiz-modal"),Q=document.getElementById("close-quiz-modal"),S=document.getElementById("start-quiz-modal-btn"),V=document.getElementById("back-to-modal-instructions"),w=document.getElementById("quiz-modal-instructions"),y=document.getElementById("quiz-modal-questions"),E=document.getElementById("quiz-modal-form");function $(){l&&(l.classList.remove("hidden"),document.body.style.overflow="hidden")}function p(){l&&(l.classList.add("hidden"),document.body.style.overflow="auto",E&&E.reset(),w&&y&&(y.classList.add("hidden"),w.classList.remove("hidden")))}Q&&Q.addEventListener("click",p);S&&w&&y&&S.addEventListener("click",()=>{w.classList.add("hidden"),y.classList.remove("hidden")});V&&w&&y&&V.addEventListener("click",()=>{y.classList.add("hidden"),w.classList.remove("hidden")});E&&E.addEventListener("submit",e=>{e.preventDefault();const o={},t=document.querySelectorAll(".question-modal-container");t.forEach((n,g)=>{const a=n.querySelector(`input[name="modal-question-${g}"]:checked`);a&&(o[g.toString()]=parseInt(a.value))});const s=Object.keys(o).length,i=t.length;if(s<i){alert(`Por favor responde todas las preguntas. Has respondido ${s} de ${i} preguntas.`);return}console.log("Quiz modal submitted:",o),alert("¡Quiz enviado! Tu puntuación será calculada y mostrada pronto."),p()});l&&l.addEventListener("click",e=>{e.target===l&&p()});document.addEventListener("keydown",e=>{e.key==="Escape"&&l&&!l.classList.contains("hidden")&&p()});window.openQuizModal=$;function P(e){const o=document.getElementById(`modal-${e}`);o&&(o.classList.remove("hidden"),document.body.style.overflow="hidden")}function B(e){const o=document.getElementById(`modal-${e}`);o&&(o.classList.add("hidden"),document.body.style.overflow="auto")}document.addEventListener("click",e=>{document.querySelectorAll('[id^="modal-"]').forEach(t=>{if(e.target===t){const s=t.id.replace("modal-","");B(s)}})});document.addEventListener("keydown",e=>{if(e.key==="Escape"){const o=document.querySelector('[id^="modal-"]:not(.hidden)');if(o){const t=o.id.replace("modal-","");B(t)}}});window.openModal=P;window.closeModal=B;

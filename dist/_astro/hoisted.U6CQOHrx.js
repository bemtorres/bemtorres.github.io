function L(e){const d=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,t=e.match(d);return t&&t[2].length===11?t[2]:null}const s=document.getElementById("youtubeModal"),m=document.getElementById("youtubeIframe"),p=document.getElementById("closeModal"),o=document.getElementById("passwordModal"),E=document.getElementById("passwordForm"),c=document.getElementById("passwordInput"),g=document.getElementById("passwordError"),B=document.getElementById("passwordMaterialName"),I=document.getElementById("closePasswordModal"),k=document.getElementById("cancelPasswordBtn"),l=document.getElementById("listViewBtn"),r=document.getElementById("gridViewBtn"),w=document.getElementById("materialsContainer");document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".youtube-modal-btn"),d=document.querySelectorAll(".password-modal-btn");e.forEach(t=>{t.addEventListener("click",function(){const n=this.getAttribute("data-youtube-url"),u=L(n);u&&s&&m?(m.src=`https://www.youtube.com/embed/${u}`,s.classList.remove("hidden"),document.body.style.overflow="hidden"):n&&window.open(n,"_blank")})}),d.forEach(t=>{t.addEventListener("click",function(){const n=this.getAttribute("data-material-url"),u=this.getAttribute("data-material-password"),a=this.getAttribute("data-material-name"),h=this.getAttribute("data-material-file-type"),i=this.getAttribute("data-is-youtube")==="true";o&&B&&(B.textContent=a,o.setAttribute("data-material-url",n||""),o.setAttribute("data-material-password",u||""),o.setAttribute("data-material-file-type",h||""),o.setAttribute("data-is-youtube",i?"true":"false"),o.classList.remove("hidden"),document.body.style.overflow="hidden",c.focus())})}),p&&p.addEventListener("click",v),s&&s.addEventListener("click",function(t){t.target===s&&v()}),I&&I.addEventListener("click",function(){f()}),k&&k.addEventListener("click",function(){f()}),o&&o.addEventListener("click",function(t){t.target===o&&f()}),E&&E.addEventListener("submit",function(t){t.preventDefault();const n=c.value,u=o.getAttribute("data-material-password"),a=o.getAttribute("data-material-url");if(o.getAttribute("data-material-file-type"),n===u){if(f(),c.value="",g.classList.add("hidden"),o.getAttribute("data-is-youtube")==="true"){const i=L(a);i&&s&&m?(m.src=`https://www.youtube.com/embed/${i}`,s.classList.remove("hidden"),document.body.style.overflow="hidden"):a&&window.open(a,"_blank")}else if(a)if(a.includes("http"))window.open(a,"_blank");else{const i=document.createElement("a");i.href=a,i.download="",i.click()}}else g.classList.remove("hidden"),c.value="",c.focus()}),document.addEventListener("keydown",function(t){t.key==="Escape"&&(s&&!s.classList.contains("hidden")&&v(),o&&!o.classList.contains("hidden")&&f())}),l&&r&&w&&(y("list"),l.addEventListener("click",()=>y("list")),r.addEventListener("click",()=>y("grid")))});function v(){s&&m&&(s.classList.add("hidden"),m.src="",document.body.style.overflow="auto")}function f(){o&&c&&g&&(o.classList.add("hidden"),c.value="",g.classList.add("hidden"),document.body.style.overflow="auto")}function y(e){!w||!l||!r||(l.classList.remove("bg-white","text-gray-900","shadow-sm"),l.classList.add("text-gray-600","hover:text-gray-900"),r.classList.remove("bg-white","text-gray-900","shadow-sm"),r.classList.add("text-gray-600","hover:text-gray-900"),w.classList.remove("grid-view","list-view"),e==="grid"?(w.classList.add("grid-view"),r.classList.remove("text-gray-600","hover:text-gray-900"),r.classList.add("bg-white","text-gray-900","shadow-sm")):(w.classList.add("list-view"),l.classList.remove("text-gray-600","hover:text-gray-900"),l.classList.add("bg-white","text-gray-900","shadow-sm")),localStorage.setItem("preferredView",e))}document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("preferredView");e&&(e==="list"||e==="grid")&&y(e)});function A(e){const d=document.getElementById(`modal-${e}`);d&&(d.classList.remove("hidden"),document.body.style.overflow="hidden")}function b(e){const d=document.getElementById(`modal-${e}`);d&&(d.classList.add("hidden"),document.body.style.overflow="auto")}document.addEventListener("click",e=>{document.querySelectorAll('[id^="modal-"]').forEach(t=>{if(e.target===t){const n=t.id.replace("modal-","");b(n)}})});document.addEventListener("keydown",e=>{if(e.key==="Escape"){const d=document.querySelector('[id^="modal-"]:not(.hidden)');if(d){const t=d.id.replace("modal-","");b(t)}}});window.openModal=A;window.closeModal=b;
